# AWS Notify Service

A Flask-based notification service that sends messages to AWS SNS topics. This service is designed to run in a Docker container and can be accessed by other containers in your network.

## Quick Start

1. Set up infrastructure and credentials:
```bash
make setup-all
```
This will:
- Create the AWS SNS topic
- Create an IAM user with required permissions
- Generate AWS access keys
- Automatically create a `.env` file with all necessary credentials

2. Build and run the service:
```bash
make build
make run
```

## Detailed Setup Instructions

### 1. Infrastructure Setup with Terraform

The project uses Terraform to set up:
- SNS Topic for notifications
- IAM user with required permissions
- Access keys for authentication

Available Terraform commands through Make:
```bash
make tf-init      # Initialize Terraform
make tf-plan      # Preview infrastructure changes
make tf-apply     # Apply infrastructure changes
make create-env   # Create .env file from Terraform outputs
make setup-all    # Run tf-apply and create-env in one command
```

### 2. Environment Configuration

The `make create-env` command automatically creates a `.env` file with the following variables:
```
AWS_ACCESS_KEY_ID=<auto-generated>
AWS_SECRET_ACCESS_KEY=<auto-generated>
AWS_REGION=<from-terraform>
AWS_SNS_TOPIC_ARN=<from-terraform>
```

### 3. Docker Container Management

Available Docker commands through Make:
```bash
make build    # Build the Docker image
make run      # Run the container (creates network if needed)
make stop     # Stop and remove the container
make restart  # Restart the container
make logs     # View container logs
make clean    # Stop container and remove image
make network  # Create Docker network
```

## API Endpoints

### Health Check
- **GET** `/health`
- Returns the service health status

### Send Notification
- **POST** `/notify`
- Request body:
```json
{
    "message": "Your notification message",
    "subject": "Optional notification subject"
}
```
- Response:
```json
{
    "message": "Notification sent successfully",
    "message_id": "AWS-SNS-Message-ID"
}
```

## Docker Network Usage

The service automatically creates and uses a Docker network called `my_network`. Other containers can access this service at `http://aws_notify:5889`.

## Development Workflow

1. Make infrastructure changes:
   ```bash
   cd terraform
   vim main.tf          # Edit infrastructure code
   make tf-plan         # Review changes
   make tf-apply        # Apply changes
   make create-env      # Update .env if needed
   ```

2. Update application and restart:
   ```bash
   make build           # Rebuild with changes
   make restart         # Restart the container
   ```

## Cleaning Up

1. Remove Docker resources:
   ```bash
   make clean
   ```

2. Destroy AWS infrastructure:
   ```bash
   cd terraform
   terraform destroy
   ```

## Available Make Commands

Run `make help` to see all available commands:
```bash
make build         - Build the Docker image
make run          - Run the container (creates network if needed)
make stop         - Stop and remove the container
make restart      - Restart the container
make logs         - View container logs
make clean        - Stop container and remove image
make network      - Create Docker network
make tf-init      - Initialize Terraform
make tf-plan      - Plan Terraform changes
make tf-apply     - Apply Terraform changes
make create-env   - Create .env file from Terraform outputs
make setup-all    - Full setup: apply Terraform and create .env
make help         - Show this help message
```